import fs from 'fs';
import csv from 'csv-parser';

let csvData: any[] = [];

export const parseCSV = (filePath: string) => {
  csvData = [];
  fs.createReadStream(filePath)
    .pipe(csv())
    .on('data', (row) => {
      csvData.push(row);
    })
    .on('end', () => {
      console.log('CSV file successfully processed');
    });
};

export const searchCSV = (query: string) => {
  const lowerCaseQuery = query.toLowerCase();
  return csvData.filter((row) =>
    Object.values(row).some((value) =>
      value.toLowerCase().includes(lowerCaseQuery)
    )
  );
};
